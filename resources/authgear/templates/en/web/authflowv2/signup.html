{{ template "authflowv2/__page_frame.html" . }}
{{ define "page-content" }}


  {{ $ctx := . }}
  {{ $display_error := false }}
  {{ if .Error }}
    {{ $display_error = true }}
  {{ end }}

	{{ $has_oauth := false }}
	{{ $has_login_id := false }}
	{{ $has_alternatives := false }}
	{{ range $.IdentityCandidates }}
		{{ if eq .type "oauth" }}
      {{ $has_oauth = true }}
      <!-- TODO(tung): Add SSO (https://github.com/authgear/authgear-server/issues/3593) -->
      {{/* $has_alternatives = true */}}
		{{ end }}
		{{ if eq .type "login_id" }}
		  {{ $has_login_id = true }}
      {{ if not (eq .login_id_key $.LoginIDKey) }}
		    {{ $has_alternatives = true }}
      {{ end }}
		{{ end }}
	{{ end }}
	{{ if $.PublicSignupDisabled }}
    <!-- TODO(tung): Update this ui (https://github.com/authgear/authgear-server/issues/3596) -->
    <div class="pane twc-container-vertical pt-8 pb-5 px-6 tablet:px-8 desktop:px-8">
      <p class="primary-txt m-0 text-base">{{ template "public-signup-disabled-notice" }}</p>
      <a class="as-btn not-a btn primary-btn my-5" href="{{ call $.MakeURL "/login" }} " data-turbo="false">{{ template "login-label" }}</a>
      {{ template "__watermark.html" . }}
    </div>
	{{ else }}
    <div class="space-y-4">
      {{ template "authflowv2/__header.html" . }}
      <h1 class="screen-title">
        {{ if $.ClientName }}
        {{ template "v2-sign-up.title" (dict "AppOrClientName" $.ClientName) }}
        {{ else }}
        {{ $appName := ($.Translations.RenderText "app.name" nil) }}
        {{ template "v2-sign-up.title" (dict "AppOrClientName" $appName) }}
        {{ end }}
      </h1>
      <h2 class="screen-description">
        {{ template "v2-sign-up.subtitle" }}
      </h2>
    </div>
    <form
      class="block mt-8"
      method="post"
      novalidate
      data-controller="retain-form-form"
      data-retain-form-form-id-value="auth-form">
      {{ $.CSRFField }}
      <input type="hidden" name="q_login_id_key" value="{{ $.LoginIDKey }}">
      {{ range $.IdentityCandidates }}
      {{ if eq .type "login_id" }}{{ if eq .login_id_key $.LoginIDKey }}
        <input type="hidden" name="q_login_id_type" value="{{ .login_id_type }}">
        <div data-controller="text-field">
          {{ if eq .login_id_type "phone" }}
            <!-- TODO(tung): Update to use phone input (https://github.com/authgear/authgear-server/issues/3561) -->
            <input
              data-text-field-target="input"
              class="block input w-full"
              tabindex="0"
              {{ if $.ShouldFocusInput }}autofocus{{ end }}
              type="text"
              inputmode="tel"
              autocomplete="tel-national"
              autocapitalize="none"
              name="q_login_id"
              placeholder="{{ template "v2-placeholder.phone" }}"
              data-retain-form-form-target="input"
              data-retain-form-form-name-param="phone"
            >
          {{ else }}
            <!-- TODO(tung): Update to use text input (https://github.com/authgear/authgear-server/issues/3557) -->
            <input
              data-text-field-target="input"
              {{ if $.ShouldFocusInput }}autofocus{{ end }}
              class="block input w-full {{ if $display_error }}input--error{{end}}"
              tabindex="0"
              type="{{ $.NonPhoneLoginIDInputType }}"
              name="q_login_id"
              autocomplete="username"
              autocapitalize="none"
              placeholder="{{ template "v2-placeholder.login-id" (dict "variant" $.LoginIDKey) }}"
              data-controller="retain-form-input"
              data-action="input->retain-form-input#input retain-form-input:input->retain-form-form#input"
              data-retain-form-form-target="input"
              data-retain-form-form-name-param="text"
            >
          {{ end }}
          {{ if $display_error }}
            <ul class="input__error-message mt-2" data-text-field-target="errorMessage">
              {{ template "authflowv2/__error.html" $ctx }}
            </ul>
          {{ end }}
        </div>
      {{ end }}{{ end }}
      {{ end }}

      {{ if $has_login_id }}
        <button
          class="primary-btn w-full mt-4"
          type="submit"
          name="x_action"
          value="login_id"
          data-authgear-event="authgear.button.sign_up"
        >{{ template "v2-button.continue" }}</button>
      {{ end }}
    </form>

    <p class="body-text--md mt-4">
      {{ $loginHref := call $.MakeURL "/login" }}
      {{ template "v2-sign-up.switch-to-login" (dict "href" $loginHref )}}
    </p>

    {{ if $has_alternatives }}
      {{ template "authflowv2/__divider.html" (dict "Classname" "my-8")  }}
      <section class="flex flex-col gap-4">
        {{ range .IdentityCandidates }}
          {{ if eq .type "login_id" }}{{ if not (eq .login_id_key $.LoginIDKey) }}
            {{ if eq .login_id_key "email" }}
              <a class="secondary-btn" data-turbo-action="replace"
                href="{{ call $.MakeURL "" "q_login_id_key" .login_id_key "q_login_id_input_type" .login_id_input_type }}">
                <i class="material-icons mr-2">mail</i>
                {{ template "v2-sign-up.signup-with-email" }}
              </a>
            {{ end }}
            {{ if eq .login_id_key "username" }}
              <a class="secondary-btn" data-turbo-action="replace"
                href="{{ call $.MakeURL "" "q_login_id_key" .login_id_key "q_login_id_input_type" .login_id_input_type }}">
                <i class="material-icons mr-2">person</i>
                {{ template "v2-sign-up.signup-with-username" }}
              </a>
            {{ end }}
            {{ if eq .login_id_key "phone" }}
              <a class="secondary-btn" data-turbo-action="replace"
                href="{{ call $.MakeURL "" "q_login_id_key" .login_id_key "q_login_id_input_type" .login_id_input_type }}">
                <i class="material-icons mr-2">smartphone</i>
                {{ template "v2-sign-up.signup-with-phone" }}
              </a>
            {{ end }}
          {{ end }}{{ end }}
        {{ end }}
      </section>
    {{ end }}
	{{ end }}

{{ end }}
